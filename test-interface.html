<!DOCTYPE html>
<html>
<head>
    <title>JDA Auth Test</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        .response { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
        .yellow { background: #fff3cd; }
        .blue { background: #e7f3ff; }
    </style>
</head>
<body>
    <h1>üöÄ JDA Auth System Test</h1>
    
    <div class="box yellow">
        <h3>üìã Test Users</h3>
        <p><strong>Admin:</strong> admin@jda.com / AdminPass123!</p>
        <p><strong>PM:</strong> pm@jda.com / PMPass123!</p>
        <p><strong>Client:</strong> client@jda.com / ClientPass123!</p>
    </div>

    <div id="userInfo" class="box blue" style="display: none;">
        <h3>üë§ Current User</h3>
        <div id="currentUserDisplay"></div>
        <button onclick="logout()">Logout</button>
    </div>

    <div class="box">
        <h2>üîê Login</h2>
        <input type="email" id="loginEmail" value="admin@jda.com" placeholder="Email">
        <input type="password" id="loginPassword" value="AdminPass123!" placeholder="Password">
        <button onclick="login()">Login</button>
        <div id="loginResponse" class="response"></div>
    </div>

    <div class="box">
        <h2>üë• Register</h2>
        <input type="email" id="regEmail" placeholder="Email">
        <input type="password" id="regPassword" placeholder="Password">
        <input type="text" id="regName" placeholder="Full Name">
        <button onclick="register()">Register</button>
        <div id="registerResponse" class="response"></div>
    </div>

    <div class="box">
        <h2>üß™ API Tests</h2>
        <button onclick="testHealth()">Health Check</button>
        <button onclick="getProfile()">My Profile</button>
        <button onclick="listUsers()">List Users</button>
        <button onclick="getStats()">System Stats</button>
        <div id="testResponse" class="response"></div>
    </div>

    <script>
        const API = "http://localhost:8000";
        let token = localStorage.getItem('token');
        let user = JSON.parse(localStorage.getItem('user') || 'null');

        updateUI();

        function updateUI() {
            if (token && user) {
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('currentUserDisplay').innerHTML = 
                    `Email: ${user.email}<br>Name: ${user.full_name}<br>Role: ${user.role}`;
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const result = await response.json();
                document.getElementById('loginResponse').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    token = result.access_token;
                    user = result.user;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(user));
                    updateUI();
                }
            } catch (error) {
                document.getElementById('loginResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const full_name = document.getElementById('regName').value;
            
            try {
                const response = await fetch(`${API}/api/v1/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, full_name, role: 'client' })
                });
                const result = await response.json();
                document.getElementById('registerResponse').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    token = result.access_token;
                    user = result.user;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(user));
                    updateUI();
                }
            } catch (error) {
                document.getElementById('registerResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function testHealth() {
            try {
                const response = await fetch(`${API}/health`);
                const result = await response.json();
                document.getElementById('testResponse').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('testResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function getProfile() {
            if (!token) {
                document.getElementById('testResponse').textContent = 'Please login first!';
                return;
            }
            
            try {
                const response = await fetch(`${API}/api/v1/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                document.getElementById('testResponse').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('testResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function listUsers() {
            if (!token) {
                document.getElementById('testResponse').textContent = 'Please login first!';
                return;
            }
            
            try {
                const response = await fetch(`${API}/api/v1/users/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                document.getElementById('testResponse').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('testResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function getStats() {
            if (!token) {
                document.getElementById('testResponse').textContent = 'Please login first!';
                return;
            }
            
            try {
                const response = await fetch(`${API}/api/v1/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                document.getElementById('testResponse').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('testResponse').textContent = 'Error: ' + error.message;
            }
        }

        function logout() {
            token = null;
            user = null;
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            document.getElementById('userInfo').style.display = 'none';
        }
    </script>
</body>
</html>
